# groupTable

## Описание
Утилита для группировки таблицы по столбцам-критериям и произведения вычислений в столбцах-мерах.

Утилита работает со следующими входными и итоговыми форматами файлов:
* **.xls**
* **.xlsx**

В первой строке таблицы-источника указываются типы столбцов:
* **Пустая ячейка** – Критерий. Все строки с
одинаковым набором значений критериев в соответствующих ячейках группируются в одну строку в итоговой таблице.
* **“-”** – неиспользуемый столбец. В
таблице-результате отсутствует. В этой ячейке можно хранить значения в любых форматах.
* **Столбцы меры**. При группировке строк с одинаковым
набором критериев с набором значений столбца-меры можно производить различные
вычисления. Другими словами, мера — это функция, позволяющая преобразовать все
данные из соответствующего столбца группы в одну ячейку таблицы-результата.
Данные для группы всегда берутся только из соответствующего столбца.  Названия типа меры можно писать в любом
регистре. Поддерживаются следующие меры:
  * **«Sum»** - вычисляет сумму всех чисел колонки, принадлежащих каждой группе. 
  * **«Max»** - находит максимальное число в группе.
  * **«Min»** - находит минимальное число в группе
  * **«Concat»** - рассматривает каждую ячейку как строку и сцепляет строки в одну.
  
## Пример
### Исходная таблица:

![Картинка с исходной таблицей](https://github.com/AndreyKamenskiy/groupTable/blob/master/src/test/testResources/table1.jpg "Картинка с исходной таблицей")
  
  Для удобства строки с одинаковыми группировками отмечены одинаковыми цветами.
  
Разбор таблицы:
1.	Критерии – столбцы A и B. Вместе они образуют 4 различных группы – a1, b1, a2, b2. 
2.	Столбец C – не используется и будет исключен из итоговой таблицы. Все остальные столбцы сохраняют свою последовательность.
3.	Столбцы-меры – D, E, F, G. Например, для столбца D используется мера sum – она складывает все значения столбца D для каждой группы. Например, для группы a1 будут сложены данные ячеек D2 и D4. В результате в строке группы a1 для меры столбца D будет стоять 16. В итоговой таблице это будет ячейка С1. Порядок строк итоговой таблицы не регламентируется и может быть произвольным.

### Итоговая таблица:
  
  В результате работы появится следующая таблица:
  
  ![Картинка с итоговой таблицей](https://github.com/AndreyKamenskiy/groupTable/blob/master/src/test/testResources/table2.jpg "Пример итоговой таблицы")
  
  
## Описание форматов

### Исходная таблица
1.	Порядок столбцов и их местоположение в исходной таблице не регламентируется и может быть любым. Например, первым столбцом таблицы может быть столбец-мера, а последним столбец-критерий.
2.	Количество строк и столбцов ограничены только используемым форматом файлов.
3.	Допустимы пустые ячейки для всех видов столбцов. Правила их об работки в столбцах-мерах будут указаны ниже.
4.	Размер таблицы не может быть меньше одного столбца и двух строк. 
5.	Определение границ исходной таблицы: размеры таблицы вычисляются до первого полностью пустого столбца или строки.

![Картинка с примером таблицы](https://github.com/AndreyKamenskiy/groupTable/blob/master/src/test/testResources/table3.jpg "Пример исходной таблицы")

Размеры этой таблицы определятся как 5 столбцов х 3 строки от А1 до E3.

6.	Столбцы критерии:
  1.	Могут быть разных внутренних форматов: STRING, NUMBER, EMPTY.
  2.	Столбцы с одинаковым графическим представлением, но разных форматов – воспринимаются как разные критерии. Таким образом строка «5», число 5.0, и формула «=4 + 1» графически в Excel будут выглядеть одинаково, но во внутренней структуре программы будут представлены разными форматами и, следовательно, будут учитываться как разные критерии.
  3.	Допустимо полное отсутствие критериев. В этом случае таблица будет свернута в одну строку, согласно столбцам мерам. При их отсутствии (только неиспользуемые строки) результатом будет пустая таблица.
7.	Неиспользуемые строки: могут быть любых форматов, которые возможно преобразовать ко внутренним. В итоговой таблицe такие столбцы отсутствуют.
8.	Столбцы меры. Подробно каждая мера будет рассмотрена ниже.
  1.	Могут отсутствовать в исходной таблице.
  2.	Каждого типа меры может быть больше одного.
  
###  Форматы данных
1.	При чтении таблицы из файла все возможные типы данных преобразуются к следующим:
  1.	NUMBER – число с плавающей запятой двойной точности double. 
  2.	STRING – строка произвольной длины.
  3.	EMPTY - Пустая ячейка.
2.	Если формат ячеек исходной таблицы не может быть преобразован в любой из трех внутренних форматов – возникает ошибка и программа заканчивает работу. Пример может быть тип ошибка с целочисленным кодом ошибки. Такую ячейку можно было бы воспринимать как число, но логики в таком представлении мало.
3.	Таблица конвертации форматов excel таблицы во внутренние форматы:

| Тип ячейки исходной таблицы	| Тип внутренней таблицы |
|-----------------------------|------------------------|
|           Число	            |         NUMBER         |
|           Cтрока	          |         STRING         |
|           Дата	            |         NUMBER         |
|           Пустая ячейка	    |         EMPTY          |
|           Формула	          | STRING. Часть ошибок могут быть записаны как формулы. Например ячейка с ошибкой деления на ноль может выть прочитана библиотекой как формула и, в этом случае, будет преобразована во внутренний формат STRING.|
|           boolean	          |         STRING. Значения «true» и «false».|
|           Ошибка            |         STRING.        |

Другие форматы	Не поддерживаются – вызывают ошибку и завершают работу программы.

### Мера SUM
1.	Вычисляет сумму всех чисел столбца в каждой группе.
2.	Все данные в столбце рассматриваются как цифры. Невозможность преобразовать ячейку к числу вызывает ошибку и прекращение работы программы.
3.	Пустая ячейка преобразуется в число 0.
4.	Сумма пустых ячеек равна числу 0.

### Мера Min
1.	Находит минимальное число столбца в каждой группе.
2.	Все данные в столбце рассматриваются как цифры. Невозможность преобразовать ячейку к числу вызывает ошибку и прекращение работы программы.
3.	Правила обработки пустых ячеек: пустая ячейка не может быть меньше любого числа.
    -	MIN(EMPTY, EMPTY) = EMPTY
    -	MIN(EMPTY, NUMBER) = NUMBER
4.	Минимум от всех пустых ячеек равна числу 0. Приведенные правила соответствуют поведению формулы **МИН** в excel.

### Мера Max
1.	Находит максимальное число столбца в каждой группе.
2.	Все данные в столбце рассматриваются как цифры. Невозможность преобразовать ячейку к числу вызывает ошибку и прекращение работы программы.
3.	Правила обработки пустых ячеек: пустая ячейка не может быть больше любого числа.
    -	MAX(EMPTY, EMPTY) = EMPTY
    -	MAX(EMPTY, NUMBER) = NUMBER
4.	Максимум от всех пустых ячеек равна числу 0. Приведенные правила соответствуют поведению формулы **МАКС** в excel.

### Мера Concat
1.	Сцепляет все значения столбца в каждой группе в одну строку.
2.	Все данные в столбце рассматриваются как строка.
3.	Пустые ячейки из типа EMPTY преобразуются в пустую строку STRING.
4.	Concat всех пустых ячеек равна пустой строке. Приведенные правила соответствуют поведению формулы **СЦЕП** в excel.

## Запуск программы
### Список доступных ключей
* **-help** -  выводит краткую помощь по использованию программы.
*	**-inputFile <fileName.ext>** –  имя входного файла. Обязательный ключ.
*	**-outputFile < fileName.ext >** - имя файла с итоговой таблицей. Необязательный ключ. При его отсутствии имя итогового файла  будет **groupingTable.xlsx**
*	**-printStats** – перед выходом из программы выводит статистику работы программы: время работы, размеры входной таблицы и итоговой.

Все ключи могут встречаться в произвольном порядке. Использование других ключей – вызовет ошибку в работе программы. Ключи могут быть записаны в любом регистре.
